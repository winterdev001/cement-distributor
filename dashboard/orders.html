<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KIKU DASHBOARD</title>
  <!-- links -->
  <link rel="stylesheet" href="dashboard.css">
  <!-- CSS only -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <!-- font-awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    .table-huva:hover {
      background-color: #00c29267 !important;
    }
  </style>
</head>

<body ng-app="admin" ng-controller="myCtrl">
  <div class="content container-fluid">
    <div class="row bg-dark">
      <div class="col-lg-2 col-md-2 col-sm-6 col-xs-12  side-navigation">
        <div class="aside">
          <!-- <h3>side</h3> -->
          <nav class="side-nav">
            <header>
              <div class="profile">
                <span ng-if="profile != 'no'"><img ng-src="../images/{{profile}}" alt="card-img-top" height="100" width="100"></span>
                <span ng-if="profile == 'no'"><img src="../images/male-icon.png" alt="card-img-top" height="100" width="100"></span>
                <span class="text-light">{{username}}</span>
                <div class="edit mt-2 p-1">
                  <span><a class="text-light text-center btn btn-grin text-decoration-none" href="edit_profile.html"> <i
                        class="fa fa-pencil fa-fw"></i> Edit</a></span>
                </div>
              </div>
            </header>
            <hr>

            <ul class="side-nav-links">
              <li><a href="dash.html" ><i class="fa fa-home fa-fw"></i> Dashboard</a></li>
              <li><a href="products.html"><i class="fa fa-archive fa-fw"></i> Products</a></li>
              <li><a href="orders.html" class="active"><i class="fa fa-calendar-check-o fa-fw"></i> Orders</a></li>
              <li><a href="users.html"><i class="fa fa-users fa-fw"></i> Users</a></li>
              <li><a href="messages.html"><i class="fa fa-envelope fa-fw"></i> Inquiries</a></li>
              <li><a href="reports.html"><i class="fa fa-file-text fa-fw"></i> Reports</a></li>
              <li><a ng-click="logout()"><i class="fa fa-sign-out fa-fw"></i> Logout</a></li>
            </ul>

          </nav>
        </div>
      </div>
      <div class="col-lg-10 col-md-10 col-sm-6 col-xs-12 bg-light">
        <div class="  ">
          <div class="row mt-3 mb-2">
            <div class="col-md-9">
              <h3>Dashboard</h3>
            </div>
            <div class="col-md-3">
              <div aria-label="breadcrumb">
                <ol class="breadcrumb ">
                  <li class="breadcrumb-item "><a class="text-dark" href="dash.html">Dashboard</a></li>
                  <li class="breadcrumb-item " aria-current="page">Orders</li>
                </ol>
              </div>
            </div>
          </div>
          <!-- all orders -->
          <div class="animated fadeIn mt-5">
            <div class="row">
              <div class="col-md-12">
                <div class="card">
                  <div class="card-header">
                    <div class="row">
                      <div class="col-md-10"><strong class="card-title">Unfulfilled Orders</strong></div>
                      <div class="col-md-2">
                        <div class="search ">
                          <div class="float-right">
                            <form action="">
                              <input type="text" ng-model="search_in_unfulfilled" class="form-control dash-search"
                                placeholder="Search...">
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card-body ">
                    <div class="table-responsive">
                      <table id="bootstrap-data-table" class="table table-striped table-bordered  ">
                        <thead>
                          <!-- <tr>
                            <th><button class="btn btn-danger" ng-click="deleteAll()">Delete Selected</button></th>
                          </tr> -->
                          <tr>
                            <!-- <th>Select</th> -->
                            <th>Order</th>
                            <th>Status</th>
                            <th>Payment</th>
                            <th>Total</th>
                            <th>Date</th>
                            <th></th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr class="table-huva"
                            ng-repeat="order in orders | filter:search_in_unfulfilled | orderBy:'-created_at'"
                            ng-if="order.status == 'unfulfilled'">
                            <!-- <td><input name="all" type="checkbox" ng-checked="product.id" /></td></td> -->
                            <td>000{{order.id}}</td>
                            <td
                              ng-class="{'text-grin': order.status == 'fulfilled','text-warning': order.status == 'unfulfilled'}">
                              <strong>{{order.status}}</strong></td>
                            <td>{{order.payment}}</td>
                            <td>{{order.grand_total |currency : value =""}}Rwf</td>
                            <td>{{order.created_at}}
                            </td>
                            <td>
                              <button class="btn btn-blu text-light" ng-click="showOrder(order)">View</button>
                              <button class="btn btn-grin text-light" ng-click="fulfillOrder(order)">Fulfill</button>
                              <button class="btn btn-danger" ng-click="deleteOrder(order.id)">Delete</button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div><!-- .all orders -->
          <!-- fulfilled orders -->
          <div class="animated fadeIn mt-5">
            <div class="row">
              <div class="col-md-12">
                <div class="card">
                  <div class="card-header">
                    <div class="row">
                      <div class="col-md-10"><strong class="card-title">Fulfilled Orders</strong></div>
                      <div class="col-md-2">
                        <div class="search ">
                          <div class="float-right">
                            <form action="">
                              <input type="text" ng-model="search_in_fulfilled" class="form-control dash-search"
                                placeholder="Search...">
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card-body ">
                    <div class="table-responsive">
                      <table id="bootstrap-data-table" class="table table-striped table-bordered  ">
                        <thead>
                          <!-- <tr>
                            <th><button class="btn btn-danger" ng-click="deleteAll()">Delete Selected</button></th>
                          </tr> -->
                          <tr>
                            <!-- <th>Select</th> -->
                            <th>Order</th>
                            <th>Status</th>
                            <th>Payment</th>
                            <th>Total</th>
                            <th>Date</th>
                            <th></th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr class="table-huva"
                            ng-repeat="order in orders | filter:search_in_fulfilled | orderBy:'-created_at'"
                            ng-if="order.status == 'fulfilled' ">
                            <!-- <td><input name="all" type="checkbox" ng-checked="product.id" /></td></td> -->
                            <td>000{{order.id}}</td>
                            <td ng-class="{'text-grin': order.status == 'fulfilled'}">
                              <strong>{{order.status}}</strong></td>
                            <td>{{order.payment}}</td>
                            <td>{{order.grand_total |currency : value =""}}Rwf</td>
                            <td>{{order.created_at}}
                            </td>
                            <td>
                              <button class="btn btn-blu text-light" ng-click="showOrder(order)">View</button>
                              <button class="btn btn-warning" ng-click="makeReceipt(order)">Invoice</button>
                              <button class="btn btn-danger" ng-click="deleteOrder(order.id)">Delete</button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
          <!-- end fulfilled orders -->
          <!-- cencelled orders -->
          <div class="animated fadeIn mt-5">
            <div class="row">
              <div class="col-md-12">
                <div class="card">
                  <div class="card-header">
                    <div class="row">
                      <div class="col-md-10"><strong class="card-title">Cancelled Orders</strong></div>
                      <div class="col-md-2">
                        <div class="search ">
                          <div class="float-right">
                            <form action="">
                              <input type="text" ng-model="search_in_cancelled" class="form-control dash-search"
                                placeholder="Search...">
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card-body ">
                    <div class="table-responsive">
                      <table id="bootstrap-data-table" class="table table-striped table-bordered  ">
                        <thead>
                          <!-- <tr>
                            <th><button class="btn btn-danger" ng-click="deleteAll()">Delete Selected</button></th>
                          </tr> -->
                          <tr>
                            <!-- <th>Select</th> -->
                            <th>Order</th>
                            <th>Status</th>
                            <th>Payment</th>
                            <th>Total</th>
                            <th>Date</th>
                            <th></th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr class="table-huva"
                            ng-repeat="order in orders | filter:search_in_cancelled | orderBy:'-created_at'"
                            ng-if="order.status == 'cancelled' ">
                            <!-- <td><input name="all" type="checkbox" ng-checked="product.id" /></td></td> -->
                            <td>000{{order.id}}</td>
                            <td ng-class="{'text-danger': order.status == 'cancelled'}">
                              <strong>{{order.status}}</strong></td>
                            <td>{{order.payment}}</td>
                            <td>{{order.grand_total |currency : value =""}}Rwf</td>
                            <td>{{order.created_at}}
                            </td>
                            <td>
                              <button class="btn btn-blu text-light" ng-click="showOrder(order)">View</button>
                              <button class="btn btn-danger" ng-click="deleteOrder(order.id)">Delete</button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div><!-- .cencelled orders -->
          <!-- end content -->
        </div>
      </div>
    </div>
  </div>
  <!-- Modal -->
  <!-- show_order -->
  <div class="modal fade" id="show_order" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Order Details</h5>

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <table class="table table-stripped mt-3 mb-3">
            <thead>
              <tr>
                <th>Order Number</th>
                <th>Product Name</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total</th>
                <!-- <th>Grand Total</th> -->
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="order-end">000{{orderz_id }}</td>
                <td class="order-end">
                  <div ng-repeat="pname in orderz_product_name">{{pname}}
                    <hr>
                  </div>
                </td>
                <td class="order-end">
                  <div ng-repeat="qty in orderz_quantity">{{qty}}
                    <hr>
                  </div>
                </td>
                <td class="order-end">
                  <div ng-repeat="amount in orderz_amount">{{amount | currency : value =""}}Rwf
                    <hr>
                  </div>
                </td>
                <td class="order-end">
                  <div ng-repeat="tot in orderz_total">{{tot | currency : value =""}}Rwf
                    <hr>
                  </div>
                </td>
                <!-- <td>{{order.grand_total}}</td> -->
                <td class="order-end"><span
                    ng-class="{'text-grin': orderz_status == 'fulfilled','text-warning': orderz_status == 'unfulfilled','text-danger': orderz_status == 'cancelled'}">{{orderz_status}}</span>
                </td>
              </tr>
              <tr>
                <td colspan="4" align="center"><strong>Delivery : {{orderz_delivery | currency : value =""}}Rwf
                    /pkg</strong></td>
                <td> <strong>Grand Total: <span
                      class="text-grin">{{grand_total | currency : value =""}}Rwf</span></strong></td>
              </tr>
              <style>
                .order-end {
                  border-bottom: 3px solid #00c292 !important;
                }
              </style>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <div class="mr-auto">Customer: <strong>{{user_email}}</strong></div>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-blu" ng-click="cancelOrder(orderz_id)">Cancel Order</button>
        </div>
      </div>
    </div>
  </div>

  <!-- left stock -->
  <div class="modal fade" id="left_stock" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Left Quantities</h5>

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <table class="table table-stripped mt-3 mb-3">
            <thead>
              <tr>
                <th>Product Name</th>
                <th>Quantity</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="pname in pnamez">
                <td>For {{pname.product_name}}</td>
                <td><strong>{{pname.stock}} packages left</strong></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- make invoice -->
  <div class="modal fade" id="make_invoice" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Invoice Details</h5>

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="full_invoice" style="font-size: 13px;">
          <div class="invoice-header">
            <div class="row">
              <div class="col-md-8">
                <div class="logo">
                  <img src="../images/logo/kiku.png" alt="" height="40" width="120"><br>
                  <div class="ml-1 mt-2">
                    <span><strong>From : </strong></span>
                    <span>KG700st. 12 Ave Masoro(Freezone)</span><br>
                    <span>+250-700-111-222</span><br>
                    <span>salessupport@kiku.com</span>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="float-right">
                  <span><strong>Invoice</strong></span> <br>
                  <span>{{curr_date}}</span> <br>
                  <div class="mt-2"><span><strong>To :</strong></span>
                    <span ng-if="invoice_company != 'no'"> <strong>{{invoice_company}}</strong></span> <br>
                    <span>{{invoice_user_names}}</span> <br>
                    <span class="text-muted">{{invoice_street}}, {{invoice_village}}, {{invoice_cell}},<br>
                      {{invoice_sector}}, {{invoice_district}}, <br>
                       {{invoice_province}}</span>, <br>
                    <span class="text-muted">{{invoice_country}}</span></div>
                </div>
              </div>
            </div>
          </div>
          <div class="invoice-body">
            <div class="row">
              <div class="col-md-2 mx-auto mt-2">
                <span><strong>Invoice#</strong></span><br>
                <span>000{{orderz_id}}</span>
              </div>
              <div class="col-md-10 mx-auto">
                <table class="table table-bordered table-stripped mt-3 mb-3">
                  <thead>
                    <tr>
                      <th>Product Name</th>
                      <th>Quantity</th>
                      <th>Price</th>
                      <th>Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="order-end">
                        <div ng-repeat="pname in orderz_product_name">{{pname}}
                          <hr>
                        </div>
                      </td>
                      <td class="order-end">
                        <div ng-repeat="qty in orderz_quantity">{{qty}}
                          <hr>
                        </div>
                      </td>
                      <td class="order-end">
                        <div ng-repeat="amount in orderz_amount">{{amount | currency : value =""}}Rwf
                          <hr>
                        </div>
                      </td>
                      <td class="order-end">
                        <div ng-repeat="tot in orderz_total">{{tot | currency : value =""}}Rwf
                          <hr>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="3" align="center"><strong>Delivery : {{orderz_delivery | currency : value =""}}Rwf
                          /pkg</strong></td>
                      <td> <strong>Grand Total: <span
                            class="text-grin">{{grand_total | currency : value =""}}Rwf</span></strong></td>
                    </tr>
                    <style>
                      .order-end {
                        border-bottom: 3px solid #00c292 !important;
                      }
                    </style>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="invoice-footer mt-3">
            <p class="modal-text">
              <strong>Signature : <span> <input type="text" class="col-4"
                    style="border: none;border-bottom: 1.5px solid rgb(46, 44, 44);"> </span></strong>
            </p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-grin text-light" ng-click="printInvoice()">PDF</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- end modals -->
  <!-- <script src="dashboard.js"></script> -->
  <script src="js/angular.min.js"></script>
  <script src="js/sweetalert2.js"></script>
  <!-- <script src="js/custom.js"></script> -->
  <!-- JS, Popper.js, and jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
    integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
    crossorigin="anonymous"></script>
     <!-- Kendo for pdf file -->
  <script src="//kendo.cdn.telerik.com/2016.3.914/js/kendo.all.min.js"></script>
  <script>
    var app = angular.module('admin', []);

    app.controller('myCtrl', function ($scope, $http, $window) {
      
      $scope.printInvoice = () => {
        kendo.drawing.drawDOM($("#full_invoice"), {
          paperSize: "A4",
          margin: "1cm",
          landscape: true,
          fontSize : "14px",
          forcePageBreak: ".my-page-break",
          repeatHeaders: true,
          pageable: true
        }).then(function (group) {
          kendo.drawing.pdf.saveAs(group, "Invoice.pdf");
        });
      }
      $scope.username = localStorage.getItem('username');
      // get admin info
      $scope.getAdminInfo = () => {
        $http({
          method: 'POST',
          url: '../api/getadmininfo.php',
          data: {
            username: $scope.username
          }
        }).then((res) => {
          $scope.password = res.data[0].password;
          $scope.profile = res.data[0].image;
          $scope.admin_id = res.data[0].id;
          console.log(res.data);
        });
      }
      $scope.getAdminInfo();

      $scope.logout = () => {
        // $scope.loggedin = false;
        if (localStorage.getItem('username') != null) {
          var removeUser = localStorage.removeItem('username');
          // $window.location.href = "./dashboard/dash.html";
        }
        $window.location.href = "../api/logout.php";
      }

      // get orders
      $scope.getOrders = () => {
        $http.get("../api/getOrders.php").then((Response) => {
          $scope.orders = Response.data;
          // console.log(Response.data)
        })
      }

      $scope.getOrders();

      // show order
      $scope.showOrder = (order) => {
        $http({
          method: 'POST',
          url: '../api/getOrderDetails.php',
          data: {
            order_id: order.id
          }
        }).then((res) => {
          var allReviews = res.data;
          var reviewsByOrder = [];
          allReviews.forEach(function (currReview) {
            var currReviewIsForNewOrder = true;
            reviewsByOrder.forEach(function (prevReviewsForThisOrder) {
              if (currReview.id === prevReviewsForThisOrder.id) {
                prevReviewsForThisOrder.product_name += ", " + currReview.product_name;
                prevReviewsForThisOrder.quantity += ", " + currReview.quantity;
                prevReviewsForThisOrder.amount += ", " + currReview.amount;
                prevReviewsForThisOrder.total += ", " + currReview.total;
                currReviewIsForNewOrder = false;
              }
            });
            if (currReviewIsForNewOrder) {
              reviewsByOrder.push(currReview);
            }
          });
          $scope.singleOrder = reviewsByOrder;
          $('#show_order').modal('show');
          $scope.orderz_id = order.id;
          $scope.orderz_product_name = $scope.singleOrder[0].product_name.split(',');
          $scope.orderz_quantity = $scope.singleOrder[0].quantity.split(',');
          $scope.orderz_amount = $scope.singleOrder[0].amount.split(',');
          $scope.orderz_total = $scope.singleOrder[0].total.split(',');
          $scope.orderz_status = $scope.singleOrder[0].status;
          $scope.orderz_delivery = $scope.singleOrder[0].shipping;
          $scope.user_email = $scope.singleOrder[0].email;
          $scope.grand_total = order.grand_total;
        });
      }

      // fulfill order
      $scope.fulfillOrder = (order) => {

        $http({
          method: 'POST',
          url: '../api/getstocklevel.php',
          data: {
            order_id: order.id
          }
        }
        ).then((response) => {
          // console.log(response.data).forEach
          let changed_stock_level = [];
          let that_id = [];
          // $scope.pnamez = [];
          response.data.forEach(element => {
            var quantity = element.quantity;
            var stock = element.stock;
            var stock_left = parseInt(stock) - parseInt(quantity);
            changed_stock_level.push(JSON.stringify(stock_left));
            that_id.push(element.pid);
            // $scope.pnamez.push( changed_stock_level );

            // console.log($scope.pnamez)
            // console.log(changed_stock_level.length)
          });
          // console.log(that_id)
          $http({
            method: 'POST',
            url: '../api/fulfillOrder.php',
            data: {
              idz: that_id,
              new_stock: changed_stock_level,
              order_id: order.id
            }
          }).then((res) => {
            // console.log(res.data);            
            if (res.data != 'failed') {
              $scope.pnamez = res.data;
              $scope.getOrders();
              Swal.fire({
                title: 'Order fulfilled successfully!',
                icon: 'success',
                showCancelButton: true,
              }).then((result) => {
                if (result.value) {
                  // $scope.getOrders();
                  $('#left_stock').modal('show');
                }
              });
            } else {
              Swal.fire({
                text: res.data,
                icon: 'warning'
              });
            }
          });
        });
      }

      // cancel order
      $scope.cancelOrder = (id) => {
        if (id != null) {
          Swal.fire({
            title: 'Are you sure?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#00c292',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, Cancel it!'
          }).then((result) => {
            if (result.value) {
              $http({
                method: 'POST',
                url: '../api/cancelOrder.php',
                data: {
                  order_id: id
                }
              }).then((res) => {
                if (res.data == 'done') {
                  Swal.fire(
                    'Cancelled!',
                    'success'
                  ).then((result) => {
                    if (result.value) {
                      $scope.getOrders();
                      $('#show_order').modal('hide');
                    }
                  })
                } else {
                  swal.fire({
                    text: res.data
                  })
                }
              })
            }
          })
        }
      }

      // delete order
      $scope.deleteOrder = (id) => {
        if (id != null) {
          Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#00c292',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, Delete it!'
          }).then((result) => {
            if (result.value) {
              $http({
                method: 'POST',
                url: '../api/deleteOrder.php',
                data: {
                  order_id: id
                }
              }).then((res) => {
                if (res.data == 'done') {
                  Swal.fire(
                    'Deleted!',
                    'success'
                  ).then((result) => {
                    if (result.value) {
                      $scope.getOrders();
                    }
                  })
                } else {
                  swal.fire({
                    text: res.data
                  })
                }
              })
            }
          })
        }
      }

      // make receipt
      $scope.makeReceipt = (order) => {
        // todays data
        var today = new Date();
        $scope.curr_date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
        $http({
          method: 'POST',
          url: '../api/getOrderDetails.php',
          data: {
            order_id: order.id
          }
        }).then((res) => {
          var allReviews = res.data;
          var reviewsByOrder = [];
          allReviews.forEach(function (currReview) {
            var currReviewIsForNewOrder = true;
            reviewsByOrder.forEach(function (prevReviewsForThisOrder) {
              if (currReview.id === prevReviewsForThisOrder.id) {
                prevReviewsForThisOrder.product_name += ", " + currReview.product_name;
                prevReviewsForThisOrder.quantity += ", " + currReview.quantity;
                prevReviewsForThisOrder.amount += ", " + currReview.amount;
                prevReviewsForThisOrder.total += ", " + currReview.total;
                currReviewIsForNewOrder = false;
              }
            });
            if (currReviewIsForNewOrder) {
              reviewsByOrder.push(currReview);
            }
          });
          $scope.singleOrder = reviewsByOrder;
          $('#make_invoice').modal('show');
          $scope.orderz_id = order.id;
          $scope.orderz_product_name = $scope.singleOrder[0].product_name.split(',');
          $scope.orderz_quantity = $scope.singleOrder[0].quantity.split(',');
          $scope.orderz_amount = $scope.singleOrder[0].amount.split(',');
          $scope.orderz_total = $scope.singleOrder[0].total.split(',');
          $scope.orderz_status = $scope.singleOrder[0].status;
          $scope.orderz_delivery = $scope.singleOrder[0].shipping;
          $scope.user_email = $scope.singleOrder[0].email;
          $scope.grand_total = order.grand_total;
          $scope.invoice_user_names = $scope.singleOrder[0].fname + " " + $scope.singleOrder[0].sname;
          $http({
            method: 'POST',
            url: '../api/getCustomerDetails.php',
            data: {
              customer_name: $scope.singleOrder[0].username
            }
          }).then((response) => {
            $scope.invoice_company = response.data[0].company;
            $scope.invoice_street = response.data[0].street;
            $scope.invoice_village = response.data[0].village;
            $scope.invoice_cell = response.data[0].cell;
            $scope.invoice_sector = response.data[0].sector;
            $scope.invoice_district = response.data[0].district;
            $scope.invoice_province = response.data[0].province;
            $scope.invoice_country = response.data[0].country;
          });
        });
      }
    });   
  </script>
</body>

</html>